---
title: "Filtering correlations"
output: html_notebook
---

Quick notes about looking at all preselected demographic variables.
Corelations calculated using *bulk_run.R*

```{r}
library(tidyverse)
library(here)
library(glue)
library(DBI)


```

```{r}
processed_db <- dbConnect(duckdb::duckdb(), here("4. Data","processed_data.duckdb"),read_only=FALSE)

```


Source tables:

```{r}
dbListTables(processed_db)
```


## Age

```{r}
gen_order <- c("Age - Greatest Gen","Age - Silent Gen","Age - Baby Boomers","Age - Gen X","Age - Gen Y","Age - Gen Z","Age - Gen Alpha")
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
tbl(processed_db,"age_and_sex") |>
  filter(Year!=2021) |>
  select(Year,Unit,Attribute,Percentage) |>
  collect() |>
  pivot_wider(names_from="Attribute",values_from = "Percentage") |>
  select(-Unit,-Year) |>
  relocate(any_of(gen_order)) |>
  GGally::ggpairs()
  
```




```{r}

tbl(processed_db,"age_and_sex") |>
  filter(Year!=2021) |>
  ggplot(aes(x=Percentage,y=fct_relevel(Attribute,gen_order))) +
  geom_violin() +
  facet_grid(.~Year) +
  theme(axis.title.y = element_blank()) +
   scale_x_continuous("Percentage of Electorate's Population"
                      )
  #geom_histogram()+
  #facet_grid( Year ~ fct_relevel(Attribute,c("Age - Silent Gen")))

```

```{r}
tbl(processed_db,"primary_vote") |>
  select(-Percentage) |>
  left_join(tbl(processed_db,"age_and_sex"), by=c("DivisionNm"="Unit","census_years"="Year")) |>
  filter(census_years!=2021)|>
  ggplot(aes(x=Percentage,y=Percentage_Diff_National,colour=as_factor(Year)))+
  geom_point()+
  facet_grid(fct_relevel(Attribute,gen_order)~PartyAb)+
  labs(x="Population Percentage",y="Primary Vote - % from National average")
  
  
```

```{r}

tbl(processed_db,"primary_vote") |>
  select(-Percentage) |>
  left_join(tbl(processed_db,"age_and_sex"), by=c("DivisionNm"="Unit","census_years"="Year")) |>
  filter(census_years!=2021)|>
  filter(str_detect(Attribute,"Gen Z")) |>
  ggplot(aes(x=Percentage,y=Percentage_Diff_National,colour=as_factor(Year)))+
  geom_point()+
  facet_grid(Year~PartyAb)+
  labs(x="Population Percentage",y="Primary Vote - % from National average",
       title= "Focus on Gen Z")


```



- Greatest Gen, merge with silent Gen. - disappearing so problaby not so relevant in terms of changes.
- focus on 4 Gens - from boomers to Zers.
- Gen Alpha does not vote yet - Their influence can be captured through houselhold structure.
- Very negative correlation
- Note slighlty positive correlation between COAL vote and percentage of baby boomers, negative correlation with Labor.
- Positive correlation between green and millenial vote, but not wih Zs . Be aware that Z percentage may not be relevant in earlier elections, as they were not of voting age (non linear model?)

## citizenship

Caution - Only citizens vote - this is just a proxy measure for multicultarity

```{r}
tbl(processed_db,"citizenship") |>
  filter(Year!=2021) |>
  ggplot(aes(x=Australian.Citizens,y="Citizens")) +
  geom_violin() +
  facet_grid(.~Year) +
  theme(axis.title.y = element_blank()) +
   scale_x_continuous("Percentage of Electorate's Population"
                      )


```


```{r}
tbl(processed_db,"primary_vote") |>
  select(-Percentage) |>
  left_join(tbl(processed_db,"age_and_sex"), by=c("DivisionNm"="Unit","census_years"="Year")) |>
  filter(census_years!=2021)|>
  filter(str_detect(Attribute,"Gen Z")) |>
  ggplot(aes(x=Percentage,y=Percentage_Diff_National,colour=as_factor(Year)))+
  geom_point()+
  facet_grid(Year~PartyAb)+
  labs(y="Population Percentage",x="Primary Vote - % from National average",
       title= "Focus on Gen Z")
```

- it looks like a big migration boom took place between 2011 and 2016.
- Clear negative correlation between % of citizens and green vote. Not so clear with ALP/Coalition.
- Not sure how informative this is, considering policy of encouraging acquisition of citizenship


## country of birth

Another proxy for multiculturality

```{r echo=FALSE, message=FALSE, warning=FALSE}
tbl(processed_db,"country_of_birth") |>
  filter(Year!=2021) |>
  select(-Unit,-Year) |>
  relocate(any_of(gen_order)) |>
  GGally::ggpairs()
  
```


```{r}
tbl(processed_db,"country_of_birth") |>
  filter(Year!=2021) |>
  collect() |>
  pivot_longer(-c(Unit,Year),names_to = "Attribute",values_to = "Percentage") |>
  ggplot(aes(x=Percentage,y=fct_relevel(Attribute,gen_order))) +
  geom_violin() +
  facet_grid(.~Year) +
  theme(axis.title.y = element_blank()) +
   scale_x_continuous("Percentage of Electorate's Population"
                      )
```

```{r}
tbl(processed_db,"primary_vote") |>
  select(-Percentage) |>
  collect() |>
  left_join(tbl(processed_db,"country_of_birth") |>
  filter(Year!=2021) |>
  collect() |>
  pivot_longer(-c(Unit,Year),names_to = "Attribute",values_to = "Percentage"),
  by=c("DivisionNm"="Unit","census_years"="Year")) |>
  filter(census_years!=2021)|>
  ggplot(aes(x=Percentage,y=Percentage_Diff_National,colour=as_factor(Year)))+
  geom_point()+
  facet_grid(Attribute~PartyAb)+
  labs(y="Population Percentage",x="Primary Vote - % from National average")
```


- Not sure how informative this is.
- Not counting for 2nd people, which may still vote with cultural group.

## Language

```{r}
tbl(processed_db,"language_granular") |>
  filter(Year!=2021) |>
  ggplot(aes(x=Australian.Citizens,y="Citizens")) +
  geom_violin() +
  facet_grid(.~Year) +
  theme(axis.title.y = element_blank()) +
   scale_x_continuous("Percentage of Electorate's Population"
                      )


```







```{r}
dbDisconnect(processed_db,shutdown=TRUE)

```

