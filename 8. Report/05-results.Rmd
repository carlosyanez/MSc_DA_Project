---
output:
  pdf_document: default
bibliography:
- book.bib
- packages.bib
---

# Results {#results}

```{r hundred-setup,message=FALSE,warning=FALSE,echo=FALSE}

results <- readRDS(path(project_path,"7. Forecast","results.rds"))
```

## Forecasting the 2022 Federal Election {#2021prediction}

The previously fitted model can be used to attempt to retroactively forecast the 2022 Federal Election. Through this process, it is possible to illustrate the model's strengths and shortcomings in capturing how demographic factors succeed and fail to capture the change in voting patterns.

This exercise uses the results from the 2021 Census of Population and Housing. The base voting percentages are taken from the last Newspoll prior to the election [@NewsPoll] . Newspoll is usually considered a good predictor of the Australian election. The values are shown in table \@ref(tab:newspoll). Please note these values are national, but since there is no cluster-level data, they will be used nonetheless.

```{r newspoll}
results$newspoll |>
  rename("Party"="PartyAb","Forecast"="Avg.Vote") |>
  mutate(Forecast=glue("{Forecast}%")) |>
  kbl(booktabs = T,caption="NewsPoll primary vote forecast, 20 May 2022",align="cr") |>
  kable_styling(latex_options = c("HOLD_position", "striped"),
                 bootstrap_options="responsive",
                 full_width=FALSE)


```

The first step in the forecasting process is to map the electorates into three clusters. The result is presented in figure \@ref(fig:2022cluster).

```{r 2022cluster,fig.cap="Clusters in 2022 Election",warning=FALSE,message=FALSE}
results_data <- results$new_data |> 
  select(Division,cluster,Metro_Area) |>
  mutate(DivisionNm=str_remove(Division,"-2022"),.keep="unused") |>
  mutate(DivisionNm=str_remove(DivisionNm," \\(II\\)"))

results_data |>
  australian_ced_map(
                   ced_gpkg=path(project_path,"4. Data","CED_2021.gpkg"),
                   fill_col="cluster",
                   colour_palette=clusters_colours,
                   plot_title="Divisions by clusters - 2022 Federal Election")

```


```{r, eval=eval_html,fig.cap="Clusters in 2022 Election - Interactive"}
library(leaflet)
library(htmltools)


pal <- leaflet::colorFactor(as.vector(clusters_colours),as.character(0:2))
rr <- tags$div(
   HTML('<h3> Clusters - 2022 Election </h3>')
 )  


sf::st_read(path(project_path,"4. Data","CED_2021.gpkg"),quiet=TRUE) |>
       left_join(results_data, by="DivisionNm") |>
  mutate(cluster=as.character(cluster)) |>
  select(DivisionNm,cluster) |>
  leaflet() |>
  addTiles()|>
  addPolygons(fillColor = ~pal(cluster),
              weight=1,
              color="white",
              opacity=1,
              fillOpacity =0.75,
              label =~DivisionNm) |>
  addLegend(pal = pal, values = ~cluster, opacity = 0.75,position="bottomleft") |>
  addControl(rr, position = "topright")


```  


After clustering, the regression models have been used to calculate a predicted outcome. Results have been transformed back to absolute values and then compared against actual and historical results. This is presented in figure \@ref(fig:electionresult), together with RMSE values in table \@ref(tab:2022rmse).

```{r electionresult, fig.cap="Comparison between prediction and election results"}
p <- results$prediction_compared |>
  mutate(cluster=as.character(cluster)) |>
  mutate(across(any_of(c("Predicted","Actual")), ~ .x/100)) |>
  mutate(PartyAb=forcats::fct_relevel(PartyAb,party_cols)) |>
  mutate(label = glue("<b>{DivisionNm}</b><br> Predicted: {round(100*Predicted,3)}% <br> Actual: {round(100*Actual,3)}%")) |>
  ggplot(aes(x=Predicted,y=Actual,colour=cluster,text=label)) 

if(eval_html){
  
  p <- p +
  geom_abline(slope=1,intercept = 0, label="0%",colour="gray50",linetype = 2,hjust=0.8,alpha=0.4) +
  geom_abline(slope=1,intercept = 0.05, label="5%",colour="orange",linetype = 2,hjust=0.8,alpha=0.4) +
  geom_abline(slope=1,intercept = -0.05, label="-5%",colour="orange",linetype = 2,hjust=0.8,alpha=0.4) +
  geom_abline(slope=1,intercept = 0.1, label="10%",colour="red",linetype = 2,hjust=0.8,alpha=0.4) +
  geom_abline(slope=1,intercept = -0.1, label="-10%",colour="red",linetype = 2,hjust=0.8,alpha=0.4) 
  
  
}else{
  p <- p +
  geomtextpath::geom_textabline(slope=1,intercept = 0, label="0%",colour="gray50",linetype = 2,hjust=0.8,alpha=0.4) +
  geomtextpath::geom_textabline(slope=1,intercept = 0.05, label="5%",colour="orange",linetype = 2,hjust=0.8,alpha=0.4) +
  geomtextpath::geom_textabline(slope=1,intercept = -0.05, label="-5%",colour="orange",linetype = 2,hjust=0.8,alpha=0.4) +
  geomtextpath::geom_textabline(slope=1,intercept = 0.1, label="10%",colour="red",linetype = 2,hjust=0.8,alpha=0.4) +
  geomtextpath::geom_textabline(slope=1,intercept = -0.1, label="-10%",colour="red",linetype = 2,hjust=0.8,alpha=0.4) 
  
}
  
  
  
  p <- p +
  geom_point(alpha=0.7) +
  facet_wrap(vars(PartyAb),ncol=2) +
  scale_colour_manual(values=clusters_colours) +
  scale_x_continuous(labels =  scales::label_percent()) +
  scale_y_continuous(labels =  scales::label_percent()) +
  labs(title="Election Forecast and Results compared")


if(eval_html){
   p |> interactive_plot()
}else{
  p
}


```



```{r 2022rmse}
results$prediction_compared |>
  group_by(PartyAb,cluster) |>
  summarise(RMSE=sqrt(mean(Error^2,na.rm=TRUE))) |>
  bind_rows(
    results$prediction_compared |>
  group_by(cluster) |>
  summarise(RMSE=sqrt(mean(Error^2,na.rm=TRUE))) |>
  mutate(PartyAb="Overall")
  ) |>
  mutate(RMSE=round(RMSE,2)) |>
  arrange(cluster,PartyAb)   |>
  pivot_wider(names_from =PartyAb, values_from=RMSE)  |>
  select(all_of(c("cluster","Overall",party_cols)))   |>
  kbl(booktabs = T,caption="RMSE per cluster, overall and by parrty",align="crrrrr") |>
  kable_styling(latex_options = c("HOLD_position", "striped"),
                 bootstrap_options="responsive",
                 full_width=FALSE)
  
```

As expected, the results fail to adequately forecast primary voting, especially when it comes to Other parties and independents. However, it can be used as a tool to analyse the vote dynamics.

## The Teal Wave

A particular phenomenon of the last election consisted in the so-called "Teal Wave", where centrist independents campaigned in traditional Coalition electorates. Most of these electorates are located in inner-city, wealthy areas of Melbourne and Sydney, where voters have consistently voted Coalition since the Australian Federation. Right-leaning voters in these areas are perceived as moderate, socially liberal ("little-l liberals") who were dissatisfied with a perceived conservative turn in Coalition politics. Teal candidates managed to unseat incumbent MPs - did they in effect capture the dissatisfied Coalition base? The results and predictions for 4 cases are presented in figure \@ref(fig:tealsplot).
```{r}
chunk_height <- knitr::opts_chunk$get()$out.height
chunk_width <- knitr::opts_chunk$get()$out.width

if(eval_html) chunk_height <- '700px'
if(eval_html) chunk_width  <- '800px'

```




```{r tealsplot, fig.cap="Example 1: Teal Wave",out.height=chunk_height,out.width=chunk_width}

warringah <- compare_results("Warringah",parties=4,results=results)
wentworth <- compare_results("Wentworth",parties=4,results=results)
goldstein <- compare_results("Goldstein",parties=4,results=results)
kooyong <- compare_results("Kooyong",parties=4,results=results)


plot_title <- "Teal voting in Melbourne and Sydney"

if(eval_html){
  
  p <- list(warringah,wentworth,goldstein,kooyong)
  
  for(i in 1:(length(p))){
   p[[i]] <- p[[i]] |> interactive_plot(annotation_x=0,annotation_y = 1.05,set_title=TRUE)
    if(i <= length(p)){
      p[[i]] <- p[[i]] |> hide_legend()
    }
  }
  
 subplot(p, nrows=2,widths=c(0.40,0.40),heights=c(0.40,0.40),margin = 0.07) |>
    layout(title = list(text=plot_title,font=list(size=14))) 
  
}else{

(warringah + wentworth) / (goldstein + kooyong) +  
  plot_layout(guides = 'collect') +
  plot_annotation(title=plot_title) +
  ggh4x::force_panelsizes(cols=12)
}

```

The answer in this case seems to indicate that the dwindling Coalition vote may not be entirely related to a new teal competitor. When comparing these results with demographic statistics from figure \@ref(fig:tealdemographics), these generational change is happening at the same pace or slower than the rest of Australia (shown by flat or growing differences in the Baby Boomer population). The same applies to the percentage of high earners. Nevertheless, the relatively low error in the prediction for the Coalition seems to indicate that the new independents managed to capture Labor and Green voters - likely of a "Labor Right" and "Blue Green" persuasion considering the areas' affluence - rather than attracting a dissatisfied Coalition base.


```{r}
dataset <- read_csv(path(project_path,"4. Data","consolidated.csv"))
clusters <- read_csv(path(project_path,"4. Data","clusters.csv"))         |>
            select(-any_of(c("Metro_Area")))

dataset <- dataset |>
           left_join(clusters,by=c("DivisionNm"="DivisionNm","election_year"="Year"))

rm(clusters)

nationals <- read_csv(path(project_path,"4. Data","cluster_values.csv")) |>
             pivot_longer(-c(Year,cluster),
                          names_to = "Attribute",values_to="National") |>
             mutate(Attribute=str_replace_all(Attribute," - ","_"),
                    Attribute=str_replace_all(Attribute,"-","_"),
                    Attribute=str_squish(Attribute),
                    Attribute=str_replace_all(Attribute," ","_")) 


demographic_data <- dataset |> 
        select(-all_of(party_cols)) |>
        select(-Metro_Area) |>
        select(-Metro,-StateAb,-election_year) |>
         pivot_longer(-c(DivisionNm,Year,cluster),
               names_to = "Attribute",values_to = "CED") |>
         mutate(Year=as.numeric(Year))                   |>
         left_join(nationals,
            by=c("Year","Attribute","cluster")) |>
          select(-cluster) |>
          mutate(Value=CED-National,.keep="unused") |>
          pivot_wider(names_from = Attribute, values_from = Value)

rm(dataset, nationals)

demographic_2021 <- read_csv(path(project_path,"4. Data","cluster_values_2021.csv")) |>
                     select(-Metro_Area, -cluster) |>
                     select(-Metro,-StateAb)

demographic_data <- demographic_data |>
                    filter(Year!=2021) |>
                    bind_rows(demographic_2021)

```

```{r tealdemographics, fig.cap="Selected demographics for teal seats",out.height=chunk_height,out.width=chunk_width}

selected_demographics <- c("Age: Baby Boomers"="Age_Baby_Boomers",
                           "Age: Geneneration Y"="Age_Gen_Y",
                           "Income: 2,000 or more"="Income_2000_or_more",
                           "Religion: No Religion/Secular"="Religion_No_Religion_Secular")

electorates <- c("Warringah","Wentworth","Goldstein","Kooyong")

p <- list()
for(electorate in electorates){
p[[length(p)+1]] <- census_plot(demographic_data,
                                electorate,
                                selected_demographics) + 
                    paletteer::scale_color_paletteer_d("colRoz::uluru") +
                    guides(color=guide_legend(nrow=3, byrow=TRUE))  
}

plot_title <- "Census attributes in teal seats"

if(eval_html){
  for(i in 1:(length(p))){
   p[[i]] <- p[[i]] |> interactive_plot(annotation_x=0,annotation_y = 1.05,set_title=TRUE)
    if(i <= length(p)){
      p[[i]] <- p[[i]] |> hide_legend()
    }
  }
  
 subplot(p, nrows=2,widths=c(0.40,0.40),heights=c(0.40,0.40),margin = 0.07)|> layout(title = list(text=plot_title,font=list(size=14))) 
  
}else{
  plot_grid(p,ncol=2,nrow=2,titletext = plot_title)    & theme(legend.position = "bottom")   
}
  
```

## The Green Wave {#green-wave}

Another feature of the past election was the increase in the number of Green Party MPs. In addition to the division of Melbourne, green candidates also won the seats of Griffith and Ryan in Brisbane. Again, do these victories have a demographic driver? Are there any differences between these electorates and contiguous divisions, and between them and other electorates where the Green have been strong contenders?

Figure \@ref(fig:greenvoting) shows the prediction of the latest and historic election results. Figure \@ref(fig:green) presents selected demographic attributes for those areas.

```{r greenvoting, fig.cap="Green Voting"}

griffith <- compare_results("Griffith",parties=3,results=results) 
ryan     <- compare_results("Ryan",parties=3,results=results) 
brisbane    <- compare_results("Brisbane",parties=3,results=results) 
wills <- compare_results("Wills",parties=3,results=results)  



plot_title <- "Green Voting"

if(eval_html){
  
  p <- list(griffith,ryan,brisbane, wills)
  
  for(i in 1:(length(p))){
   p[[i]] <- p[[i]] |> interactive_plot(annotation_x=0,annotation_y = 1.05,set_title=TRUE)
    if(i <= length(p)){
      p[[i]] <- p[[i]] |> hide_legend()
    }
  }
  
 subplot(p, nrows=2,widths=c(0.40,0.40),heights=c(0.40,0.40),margin = 0.07)|> layout(title = list(text=plot_title,font=list(size=14))) 
  
}else{

(griffith + ryan) / (brisbane + wills) +  
  plot_layout(guides = 'collect') +
  plot_annotation(title=plot_title)
  
}

```

```{r green, fig.cap="Demographics in Green strongholds"}

selected_demographics <- c("Age: Baby Boomers","Age_Baby_Boomers",
                           "Religion: Catholic","Religion_Catholic",
                           "Income: 2,000 or more","Income_2000_or_more",
                           "Religion: No Religion/Secular","Religion_No_Religion_Secular",
                           "Relgigion: Anglican, Uniting and Pressbyterian","Religion_Anglican_Uniting_Presbyterian")

electorates <- c("Griffith","Ryan","Brisbane","Wills")

p <- list()
for(electorate in electorates){
p[[length(p)+1]] <- census_plot(demographic_data,
                                electorate,
                                selected_demographics) + 
                    paletteer::scale_color_paletteer_d("colRoz::uluru")  +
                    guides(color=guide_legend(nrow=3, byrow=TRUE)) 
}


plot_title <-  "Census attributes selected in Green strongholds"

if(eval_html){
  for(i in 1:(length(p))){
   p[[i]] <- p[[i]] |> interactive_plot(annotation_x=0,annotation_y = 1.05,set_title=TRUE)
    if(i <= length(p)){
      p[[i]] <- p[[i]] |> hide_legend()
    }
  }
  
 subplot(p, nrows=2,widths=c(0.40,0.40),heights=c(0.40,0.40),margin = 0.07)|> layout(title = list(text=plot_title,font=list(size=14))) 
  
}else{
  plot_grid(p,ncol=2,nrow=2,titletext = plot_title)    & theme(legend.position = "bottom")   
}
  


```

All four cases show a similar story of continuous growth of the Green vote and progressive decline of Coalition and Labor polling results. However, there are two distinct dynamics at play. In three Queensland electorates (Griffith, Ryan and Brisbane) the Green's growth is sustained in a smaller percentage or older population, being replaced by a younger, wealthier, more secular electorate. In the Victorian seat of Wills, income growth is smaller, generational renewal is slower and although the rise in secularism is faster than average, the area used to have a very high concentration of Catholic followers (Northern suburbs of Melbourne being a popular area amongst post-war Italian migrants). These factors have given Labor a stronger hold in the area.

## The Changing Face of Suburbia

For a comparison outside inner city areas, four suburban electorates have been chosen: Hasluck (Perth), Menzies (Melbourne), Fowler (Sydney) and Kingston (Adelaide). Their respective predictions and results are presented in figure \@ref(fig:suburbia1). A selection of key demographic variables is presented in figure \@ref(fig:suburbia2).

```{r suburbia1, fig.cap="Suburban Voting"}

hasluck <- compare_results("Hasluck",parties=3,results=results) 
menzies     <- compare_results("Menzies",parties=3,results=results) 
fowler    <- compare_results("Fowler",parties=3,results=results) 
kingston <- compare_results("Kingston",parties=3,results=results) 


plot_title <- "Suburban electorates"

if(eval_html){
  
  p <- list(hasluck,menzies,fowler,kingston)
  
  for(i in 1:(length(p))){
   p[[i]] <- p[[i]] |> interactive_plot(annotation_x=0,annotation_y = 1.05,set_title=TRUE)
    if(i <= length(p)){
      p[[i]] <- p[[i]] |> hide_legend()
    }
  }
  
 subplot(p, nrows=2,widths=c(0.40,0.40),heights=c(0.40,0.40),margin = 0.07)|> layout(title = list(text=plot_title,font=list(size=14))) 
  
}else{
(hasluck + menzies) / (fowler + kingston) +  
  plot_layout(guides = 'collect') +
  plot_annotation(title=plot_title)
}

```

```{r suburbia2, fig.cap="Demographics in suburban seats"}

selected_demographics <- c("Age: Baby Boomers","Age_Baby_Boomers",
                           "Language: South Asian","Language_South_Asian",
                           "Religion: Islamn","Religion_Islam",
                           "Household: Standalone","Household_Standalone",
                           "Age: Generation Y","Age_Gen_Y",
                           "Language: European","Language_European")


electorates <- c("Hasluck","Menzies","Fowler","Kingston")

p <- list()
for(electorate in electorates){
p[[length(p)+1]] <- census_plot(demographic_data,
                                electorate,
                                selected_demographics) + 
                    paletteer::scale_color_paletteer_d("colRoz::virgo") +
                    theme(legend.position='bottom') +
                    guides(color=guide_legend(nrow=3, byrow=TRUE)) 
}


plot_title <-  "Suburban electorates"

if(eval_html){
  for(i in 1:(length(p))){
    p[[i]] <- p[[i]] |> interactive_plot(annotation_x=0,annotation_y = 1.05,set_title=TRUE)
    if(i <= length(p)){
      p[[i]] <- p[[i]] |> hide_legend()
    }
  }
  
  subplot(p, nrows=2,widths=c(0.40,0.40),heights=c(0.40,0.40),margin = 0.07) |> layout(title = list(text=plot_title,font=list(size=14))) 
  
}else{
  plot_grid(p,ncol=2,nrow=2,titletext = plot_title)    & theme(legend.position = "bottom")   
}


```

From both figures, there are perhaps four different stories in these electorates:

-   In **Hasluck** (WA) [@hasluckresults], the changes have the top maybe be driven by generational renewal. The "Other" vote increase includes progressive independents and localist parties, which may have influenced the lower-than-predicted results for the Greens.
-   In **Menzies** (VIC) [@menziesresults], Coalition numbers decline influenced by generational change and a large decrease in the percentage of standalone houses. This abrupt change took place as an effect of the 2021 redistribution, where semi-rural areas moved into another electorate [@vicredist]. This a good example where the existing model was able to effectively predict the primary vote based on those demographic changes.
-   In **Fowler** (NSW) [@fowlerresults], an independent candidate altered Labor's trend. In these cases, a community-based candidate captured the multicultural vote from a "parachuted" Labor nominee - which is a variable not considered in the model. [@https://www.abc.net.au/news/catherine-hanrahan/79018522022]
-   In the case of **Kingston (SA) [@kingstonresults]**, it seems difficult to explain the results by effect of demographic changes - even when 


```{r}
rm(list=ls()[!(ls() %in% keep_vars)])
```
