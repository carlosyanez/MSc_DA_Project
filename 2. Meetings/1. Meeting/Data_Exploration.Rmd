---
title           : "Data Summary"
programme       : "Data Analytics MSc (ODL)"
subject         : "Project"
author          : "Carlos Yanez Santibanez"
date            : "15 October 2022"

documentclass   : article   # article (default) report
fontsize        : 11pt      # 10pt 11pt (default) 12pt
lang            : en-GB
output:
  bookdown::pdf_book:
    base_format: uofgdataanalyticsreport::uofgdataanalyticsreport
    pandoc_args: --listings
    fig_caption: yes
    number_sections: yes
    toc: no
    md_extensions: +yaml_metadata_block

---


```{r setup, include = FALSE}
library(tidyverse)
library(here)
library(fs)
library(uofgdataanalyticsreport)
library(lubridate)
library(flextable)
library(showtext)
library(sysfonts)
library(sf)
library(knitr)


sysfonts::font_add_google("Roboto","Roboto")
showtext::showtext_auto()

knitr::opts_chunk$set(
 # fig.width=9, fig.height=3.5, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = FALSE,
  eval = TRUE,
  include=TRUE,
  message = FALSE, 
  warning = FALSE,
  fig.show = TRUE,
  hiline = TRUE
)
```

```{r title_page, echo=FALSE,include=TRUE}
cd_header_footer()  #adds header and footer
cd_page_title()     #title page

#to customise, run ?function to see the relevant parameters
```

```{r load_data}

files_dir <- path(here(),"2. Meetings","1. Meeting","0. data sample")
files <-dir_ls(files_dir,regexp = "[.]csv$")

data <- list()
for(i in 1:length(files)){
  data[[i]] <- read_csv(files[i])
}

files <- str_remove_all(files,files_dir) %>% 
         str_remove_all(.,"[/]")         %>%
         str_remove_all(., "[.]csv")
  
names(data) <- files
rm(files_dir,files)

```

# Data Summary

The data here presented contains:

* Electoral results for the Australian 2022 Federal Election, retrieved from the Australian Electoral Commissions  website.
* Census 2021 Results, 
* Other Statistical Information, retrieved by the {readabs} package.
* Sample meteorological data, collected by the {cropgrowdays} package.


# Electoral Results


```{r}
data$sample_fed_elections_vic_2022 %>% 
  filter(DivisionNm=="Macnamara") %>%
  filter(PollingPlace %in% c("Albert Park","Alfred Square")) %>%
  flextable() %>%
  autofit() %>%
  plot()
```


```{r}

votes_per_electorate <- data$sample_fed_elections_vic_2022 %>%
                        group_by(DivisionNm) %>%
                        summarise(total_votes = sum(OrdinaryVotes,na.rm=TRUE),.groups="drop")

primary_vote <- data$sample_fed_elections_vic_2022 %>%
                group_by(DivisionNm,PartyNm) %>%
                summarise(primary_vote = sum(OrdinaryVotes,na.rm=TRUE),.groups="drop") %>%
                left_join(votes_per_electorate,by="DivisionNm") %>%
                mutate(primary_perc = primary_vote/total_votes) %>%
                select(-total_votes)
  

primary_vote %>% 
    filter(DivisionNm=="Macnamara") %>%
    arrange(desc(primary_perc))     %>%
    kbl()

```



```{r}

vic_hex <- st_read(path(here(),"2. Meetings","1. Meeting","vic_hex.geojson"))

primary_vote %>% 
    rename("Percentage"="primary_perc") %>%
    filter(PartyNm == "Australian Labor Party") %>%
    left_join(vic_hex,by=c("DivisionNm"="Elect_div")) %>%
    ggplot(aes(geometry=geometry,fill=Percentage,label=DivisionNm)) +
    geom_sf() +
    geom_sf_text(size=1.5)+
    customthemes::custom_map_theme() +
    scale_fill_gradient(low="#FFFFFF",high="#E13940") +
    labs(title="Vote in Victoria - Labor Party")
  
  

```

# Census 2021 Results

```{r}
data$census_tables  %>%
    flextable() %>%
    autofit() %>%
    plot()
```


Data comes already aggregated by electoral divisions, e.g.:

```{r}
data$household_income %>%
  head() %>%
    flextable() %>%
    autofit() %>%
    plot()

```



```{r}
data$household_income %>% 
  rename("Median Income"="medianTotalHouseholdIncome") %>%
  right_join(vic_hex,by=c("CED_NAME21"="Elect_div")) %>%
   ggplot(aes(geometry=geometry,fill=`Median Income`)) +
    geom_sf() +
    geom_sf_text(aes(label=CED_NAME21),size=1.5)+
    customthemes::custom_map_theme() +
    scale_fill_gradient(low="purple",high="green") +
    labs(title="Median House Income in Victoria- 2021 Census")
  
```

# Weather Data

```{r}
data$sample_bom_mel
```


